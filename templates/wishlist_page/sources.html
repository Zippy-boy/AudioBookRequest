{% extends "base.html" %}
{% block head %}
  <title>Sources</title>
{% endblock head %}
{% block body %}
  <div class="app-shell app-shell-compact" id="sources">
    <div class="app-content">
      <div class="flex items-center justify-between mb-8">
          <div>
              <h1 class="text-4xl font-black">Sources</h1>
              <p class="text-sm opacity-60 mt-1">Available downloads for {{ result.book.title }}</p>
          </div>
          <a preload
             href="{{ base_url }}/wishlist#{{ result.book.asin }}"
             class="btn btn-ghost bg-base-200 btn-sm rounded-xl font-black uppercase text-[10px] tracking-wider px-4">&larr; Back to Wishlist</a>
      </div>
      
      {% if result.state.ok and not result.sources %}
        <div role="alert" class="alert bg-base-200 border-base-300 rounded-2xl p-6">
          <span class="stroke-info h-6 w-6 shrink-0">{% include "icons/info-circle.html" %}</span>
          <span class="font-bold">No results found for "{{ result.book.title }}". Might have to be looked up manually.</span>
        </div>
      {% elif not result.ok %}
        <div role="alert"
             class="alert bg-primary/10 border-primary/20 text-primary rounded-2xl p-6"
             hx-get="{{ base_url }}/wishlist/sources/{{ result.book.asin }}?only_body=true"
             hx-trigger="load"
             hx-target="#sources"
             hx-swap="outerHTML">
          <span class="loading loading-dots"></span>
          <span class="font-black uppercase tracking-widest text-xs">Fetching sources from prowlarr...</span>
        </div>
      {% endif %}

      {% if result.sources %}
      <div class="flex flex-col gap-2" id="source-list">
        {% include "wishlist_page/source_items.html" %}
      </div>
      {% if result.has_more %}
      <div class="mt-4">
        <button
          class="btn btn-outline w-full rounded-xl"
          hx-get="{{ base_url }}/wishlist/sources/{{ result.book.asin }}?items_only=true&page={{ result.page + 1 }}"
          hx-target="#source-list"
          hx-swap="beforeend"
        >
          Load more sources
        </button>
      </div>
      {% endif %}
      {% endif %}
    </div>
  </div>
{% endblock body %}
